<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>مشروع التوعية بالإسعافات الأولية</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Tajawal', sans-serif;
      background: linear-gradient(135deg, #f0f8ff, #e3ffe6);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }

    header {
      background: linear-gradient(to right, #0d4c92, #0c8a85);
      color: white;
      padding: 25px 20px;
      text-align: center;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: "⨋";
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 4rem;
      opacity: 0.05;
      transform: rotate(25deg);
    }

    header::after {
      content: "⁕";
      position: absolute;
      bottom: 5px;
      right: 20px;
      font-size: 3.5rem;
      opacity: 0.05;
      transform: rotate(-15deg);
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 12px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 2;
    }

    header p {
      font-size: 1.1rem;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.7;
      position: relative;
      z-index: 2;
    }

    .container {
      max-width: 1200px;
      margin: 30px auto;
      display: grid;
      grid-template-columns: 1.2fr 2fr;
      gap: 30px;
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }
    }

    .info-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      margin-bottom: 25px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" opacity="0.03" width="40" height="40" viewBox="0 0 24 24"><path d="M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" /><path d="M17,13a1,1,0,0,0,.707-.293l1.414-1.414a1,1,0,1,0-1.414-1.414l-1.414,1.414A1,1,0,0,0,17,13ZM12,14a2,2,0,1,0-2-2A2,2,0,0,0,12,14Zm-3.707.293a1,1,0,1,0-1.414,1.414l1.414,1.414a1,1,0,0,0,1.414-1.414ZM9,11a1,1,0,0,0-.707-.293l-1.414-1.414A1,1,0,1,0,5.465,10.707l1.414,1.414A1,1,0,0,0,9,11Zm6.586-.293L14.879,8.879a1,1,0,0,0-1.414,1.414l.707.707a1,1,0,0,0,1.414,0A1,1,0,0,0,15.586,10.707Z" /></svg>');
      background-repeat: repeat;
      background-size: 80px;
    }

    .section-title {
      color: #0c5460;
      position: relative;
      padding: 15px 0;
      margin-bottom: 20px;
      font-size: 1.8rem;
      text-align: center;
    }
    
    .section-title::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 50%;
      transform: translateX(50%);
      width: 150px;
      height: 3px;
      background: linear-gradient(90deg, #139c96, #0d4c92);
      border-radius: 3px;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .first-aid-info {
      list-style: none;
      padding-right: 15px;
    }

    .first-aid-info li {
      margin-bottom: 18px;
      padding-right: 35px;
      position: relative;
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .first-aid-info li:before {
      content: "✚";
      position: absolute;
      right: 0;
      top: 5px;
      width: 28px;
      height: 28px;
      background-color: #0d4c92;
      border-radius: 50%;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1rem;
    }

    .alert {
      padding: 18px;
      border-radius: 10px;
      margin-bottom: 25px;
      display: none;
      font-size: 1.05rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      position: relative;
    }

    .alert-close {
      position: absolute;
      left: 15px;
      top: 15px;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #555;
    }

    .alert-danger {
      background-color: #ffebee;
      border: 2px solid #ffcdd2;
      color: #c62828;
    }

    .alert-success {
      background-color: #e8f5e9;
      border: 2px solid #c8e6c9;
      color: #2e7d32;
    }

    .alert-info {
      background-color: #e3f2fd;
      border: 2px solid #bbdefb;
      color: #1565c0;
    }

    .form-group {
      margin-bottom: 25px;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 10px;
      color: #1a237e;
      font-size: 1.1rem;
      font-weight: bold;
      padding-right: 8px;
    }

    input, select {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #bbdefb;
      border-radius: 12px;
      font-size: 1.1rem;
      background-color: #f8f9fa;
      transition: all 0.3s;
      font-family: 'Tajawal', sans-serif;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #1e88e5;
      box-shadow: 0 0 0 4px rgba(25, 118, 210, 0.2);
    }

    .btn {
      background: linear-gradient(135deg, #0d4c92, #139c96);
      color: white;
      border: none;
      padding: 16px 32px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.15rem;
      font-weight: bold;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      box-shadow: 0 5px 15px rgba(13, 76, 146, 0.25);
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 7px 20px rgba(13, 76, 146, 0.35);
    }

    #studentCard {
      background: linear-gradient(135deg, #ffffff, #f1f8ff);
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
      padding: 0;
      display: none;
      position: relative;
      overflow: hidden;
      border: 2px solid #e1f5fe;
    }

    /* عناصر خاصة بالبطاقة فقط */
    .card-background {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" opacity="0.04" width="120" height="120" viewBox="0 0 100 100"><circle cx="20" cy="20" r="5" /><path d="M80,80 Q90,70 95,80 T80,90 Z" /><rect x="50" y="50" width="10" height="10" /><path d="M30,60 C40,65 45,75 30,80 Z" /></svg>');
    }
    
    .card-glow {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at center, rgba(19, 156, 150, 0.15), transparent 70%);
      z-index: 2;
    }

    .medical-badge {
      position: absolute;
      top: 25px;
      left: 25px;
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #139c96, #0d4c92);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 5;
    }

    .medical-badge svg {
      width: 50px;
      height: 50px;
      fill: white;
    }

    .card-content {
      position: relative;
      z-index: 3;
      padding: 35px;
      padding-top: 45px;
      color: #333;
    }

    .student-info {
      text-align: center;
    }

    .student-name {
      font-size: 2.4rem;
      color: #0d4c92;
      margin: 25px 0 10px;
      font-weight: bold;
      position: relative;
    }

    .student-name:after {
      content: '';
      position: absolute;
      bottom: -10px;
      right: 50%;
      transform: translateX(50%);
      width: 80px;
      height: 3px;
      background: linear-gradient(90deg, #0d4c92, #139c96);
    }

    .student-detail {
      font-size: 1.4rem;
      color: #444;
      margin: 20px 0;
      line-height: 1.7;
    }

    .student-code {
      background: linear-gradient(135deg, #0d4c92, #139c96);
      color: white;
      padding: 10px 30px;
      border-radius: 30px;
      display: inline-block;
      font-size: 1.3rem;
      font-weight: bold;
      letter-spacing: 3px;
      margin-top: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(255,255,255,0.3);
    }

    .student-code:before {
      content: '';
      position: absolute;
      top: -5px;
      left: -20px;
      width: 20px;
      height: 120%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transform: rotate(15deg);
    }

    .congrats-message {
      background: rgba(240, 250, 255, 0.8);
      border-radius: 20px;
      padding: 25px;
      margin: 35px 0;
      text-align: center;
      border-top: 4px solid #139c96;
      position: relative;
      z-index: 3;
      backdrop-filter: blur(3px);
    }

    .congrats-message:before {
      content: '❝';
      position: absolute;
      top: -25px;
      left: 20px;
      font-size: 4rem;
      color: #0d4c92;
      opacity: 0.1;
    }

    .congrats-title {
      color: #0d4c92;
      font-size: 2rem;
      margin-bottom: 20px;
      position: relative;
      z-index: 4;
    }

    .congrats-text {
      font-size: 1.3rem;
      line-height: 1.9;
      color: #444;
      margin-bottom: 10px;
    }

    .card-footer {
      background: linear-gradient(135deg, rgba(13, 76, 146, 0.9), rgba(19, 156, 150, 0.95));
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
      z-index: 10;
      border-radius: 0 0 18px 18px;
      overflow: hidden;
    }

    .card-footer:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 10px;
      background: linear-gradient(90deg, #139c96, #1e88e5, #305c82, #139c96);
      background-size: 200% 200%;
      animation: rainbow 4s linear infinite;
    }

    .card-footer p {
      margin: 8px 0;
      font-size: 1.1rem;
    }

    .card-actions {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 35px;
    }

    .action-btn {
      display: flex;
      font-size: 1.1rem;
      padding: 15px 30px;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
      border: none;
      z-index: 2;
    }

    .action-btn:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.2);
      z-index: -1;
      transition: transform 0.5s;
      transform: translateY(100%);
    }

    .action-btn:hover:before {
      transform: translateY(0);
    }

    .save-btn {
      background: linear-gradient(135deg, #8e44ad, #3498db);
      color: white;
      box-shadow: 0 5px 15px rgba(79, 70, 186, 0.3);
    }

    .telegram-btn {
      background: linear-gradient(135deg, #1e88e5, #0d47a1);
      color: white;
      box-shadow: 0 5px 15px rgba(30, 136, 229, 0.3);
    }

    .action-btn svg {
      width: 24px;
      height: 24px;
      margin-left: 10px;
    }

    #captureContainer {
      position: absolute;
      top: -10000px;
      left: -10000px;
      opacity: 0;
      z-index: -100;
    }

    .credits {
      text-align: center;
      padding: 20px;
      color: #3e4650;
      font-size: 1.1rem;
      margin-top: 40px;
      border-top: 2px solid #139c96;
    }

    /* رسوم متحركة */
    @keyframes rainbow {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    .card-wave {
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 100%;
      height: 20px;
      background: url('data:image/svg+xml;utf8,<svg viewBox="0 0 1200 120" xmlns="http://www.w3.org/2000/svg" fill="rgba(19, 156, 150, 0.1)"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" /></svg>');
      background-size: cover;
    }
	.compress-btn {
      background: #ff6b00;
      margin-top: 15px;
      padding: 12px 25px;
    }
  </style>
</head>
<body>
  <header>
    <h1>مشروع التوعية بالإسعافات الأولية</h1>
    <p>مبادرة علمية تحت إشراف الدكتور حيدر لنشر الوعي الصحي بين طلبة الجامعات</p>
  </header>
  
  <div class="container">
    <div class="info-section">
      <h2 class="section-title">الإسعافات الأولية الأساسية</h2>
      <ul class="first-aid-info">
        <li>في حالة فقدان الوعي: تأكد من فتح مجرى التنفس وضع المصاب بوضع الإفاقة</li>
        <li>في حالة الجروح: اضغط على الجرح بضمادة نظيفة لوقف النزيف واغسله بالماء النظيف</li>
        <li>في حالة الحروق: استخدم الماء البارد الجاري لمدة 10-20 دقيقة لحين وصول المساعدة</li>
        <li>في حالة الكسور: ثبت الجزء المصاب دون محاولة تقويم العظام واستخدم الجبائر إن أمكن</li>
        <li>في حالة اللدغات السامة: حاول التعرف على مصدر اللدغة واحتفظ بالجزء الملدوغ في مستوى أقل من القلب</li>
        <li>في حالة السكتة القلبية: ابدأ في الإنعاش القلبي الرئوي فورًا بضغطات الصدر ثم استدعاء الإسعاف</li>
        <li>تجنب تقديم الماء أو الطعام لمن يعاني من صعوبة في البلع أو إن كان فاقدًا للوعي</li>
        <li>يجب على المسعف الأولي أن يثقف نفسه باستمرار ويحتفظ بعدة إسعافات أولية في مكان قريب</li>
      </ul>
    </div>
    
    <div class="card">
      <h2 class="section-title">تسجيل بيانات الطالب</h2>
      
      <div id="alertMessage" class="alert alert-info">
        <button class="alert-close">✕</button>
        <div id="alertText">أدخل البيانات المطلوبة للحصول على بطاقة الطالب</div>
      </div>
      
      <form id="studentForm">
        <div class="form-group">
          <label for="fullName">الاسم الثلاثي:</label>
          <input type="text" id="fullName" placeholder="ادخل اسمك الثلاثي كما في القائمة" required>
        </div>
        
        <div class="form-group">
          <label for="college">الكلية/الجامعة:</label>
          <input type="text" id="college" value="جامعة الهادي" required>
        </div>
        
        <div class="form-group">
          <label for="studyLevel">المرحلة الدراسية:</label>
          <select id="studyLevel" required>
            <option value="">اختر المرحلة الدراسية</option>
            <option value="الأولى">الأولى</option>
            <option value="الثانية">الثانية</option>
            <option value="الثالثة">الثالثة</option>
            <option value="الرابعة">الرابعة</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="studyType">نوع الدراسة:</label>
          <select id="studyType" required>
            <option value="">اختر نوع الدراسة</option>
            <option value="صباحية">صباحية</option>
            <option value="مسائية">مسائية</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="studentId">الكود المخصص:</label>
          <input type="text" id="studentId" placeholder="ادخل الكود الخاص بك" required>
        </div>
        
        <button type="submit" class="btn">✓ تأكيد المعلومات</button>
      </form>
      
      <div id="studentCard">
        <div class="card-background"></div>
        <div class="card-glow"></div>
        <div class="medical-badge">
          <svg viewBox="0 0 24 24">
            <path d="M18.031,16.617l0.708-0.707c0,0-0.885-1.652-1.5-3c-1.062-2.326-0.5-4.5-0.5-4.5H7v-3h10l-0.666-1.996L15.5,3H5.5 l-0.834,2.501L4,5.5v13h12.031C16.031,18.5,18.031,16.617,18.031,16.617z M12.5,17.5h-1v-6h1V17.5z M13.25,10c-0.414,0-0.75-0.336-0.75-0.75 S12.836,8.5,13.25,8.5S14,8.836,14,9.25S13.664,10,13.25,10z"/>
          </svg>
        </div>
        
        <div class="card-content">
          <div class="student-info">
            <h3 class="student-name" id="cardName"></h3>
            <p class="student-detail" id="cardCollege"></p>
            <p class="student-detail" id="cardLevel"></p>
            <p class="student-detail" id="cardType"></p>
            <p class="student-detail" id="cardId"></p>
            <div class="student-code" id="uniqueCode">00XXXXXX</div>
          </div>
          
          <div class="congrats-message">
            <h4 class="congrats-title">مبروك! تم قبول انضمامك للمشروع</h4>
            <p class="congrats-text">يسرنا انضمامك إلى فريق التوعية الصحية بإسعافات الجامعة.</p>
            <p class="congrats-text">يشرفنا وجودك معنا في هذه المبادرة المهمة التي تهدف إلى نشر الثقافة الصحية بين طلبة الجامعات.</p>
          </div>
        </div>
        
        <div class="card-actions">
          <button id="saveBtn" class="action-btn save-btn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            حفظ البطاقة
          </button>
          <button id="telegramBtn" class="action-btn telegram-btn">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            إرسال للتليجرام
          </button>
        </div>
        
        <div class="card-footer">
          <p>مشروع التوعية الصحية تحت شعار: الإسعاف الأولي - بوابتك للسلامة والصحة</p>
          <p>المشرف: الدكتور حيدر</p>
        </div>
        <div class="card-wave"></div>
      </div>
    </div>
  </div>
  
  <!-- نسخة للتصوير -->
  <div id="captureContainer">
    <div id="idCardForCapture" style="width: 600px; height: 800px; position: relative; border-radius: 20px; overflow: hidden; background: linear-gradient(135deg, #ffffff, #f1f8ff); color: #333; font-family: 'Tajawal', sans-serif;">
      <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" opacity=\"0.04\" width=\"120\" height=\"120\" viewBox=\"0 0 100 100\"><circle cx=\"20\" cy=\"20\" r=\"5\" /><path d=\"M80,80 Q90,70 95,80 T80,90 Z\" /><rect x=\"50\" y=\"50\" width=\"10\" height=\"10\" /><path d=\"M30,60 C40,65 45,75 30,80 Z\" /></svg>')"></div>
      <div style="position: absolute; width: 100%; height: 100%; background: radial-gradient(circle at center, rgba(19, 156, 150, 0.15), transparent 70%);"></div>
      
      <div style="position: absolute; top: 25px; left: 25px; width: 100px; height: 100px; background: linear-gradient(135deg, #139c96, #0d4c92); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);">
        <svg width="50" height="50" viewBox="0 0 24 24" fill="white">
          <path d="M18.031,16.617l0.708-0.707c0,0-0.885-1.652-1.5-3c-1.062-2.326-0.5-4.5-0.5-4.5H7v-3h10l-0.666-1.996L15.5,3H5.5 l-0.834,2.501L4,5.5v13h12.031C16.031,18.5,18.031,16.617,18.031,16.617z M12.5,17.5h-1v-6h1V17.5z M13.25,10c-0.414,0-0.75-0.336-0.75-0.75 S12.836,8.5,13.25,8.5S14,8.836,14,9.25S13.664,10,13.25,10z"/>
        </svg>
      </div>
      
      <div style="position: relative; padding: 35px; padding-top: 45px;">
        <div style="text-align: center;">
          <div id="captureCardName" style="font-size: 2.4rem; color: #0d4c92; margin: 25px 0 10px; font-weight: bold;"></div>
          <div id="captureCardCollege" style="font-size: 1.4rem; color: #444; margin: 20px 0;"></div>
          <div id="captureCardLevel" style="font-size: 1.4rem; color: #444; margin: 20px 0;"></div>
          <div id="captureCardType" style="font-size: 1.4rem; color: #444; margin: 20px 0;"></div>
          <div id="captureCardId" style="font-size: 1.4rem; color: #444; margin: 20px 0;"></div>
          <div id="captureUniqueCode" style="background: linear-gradient(135deg, #0d4c92, #139c96); color: white; padding: 10px 30px; border-radius: 30px; display: inline-block; font-size: 1.3rem; font-weight: bold; letter-spacing: 3px; margin-top: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); border: 2px solid rgba(255,255,255,0.3);"></div>
        </div>
        
        <div style="background: rgba(240, 250, 255, 0.8); border-radius: 20px; padding: 25px; margin: 35px 0; text-align: center; border-top: 4px solid #139c96; position: relative;">
          <h4 style="color: #0d4c92; font-size: 2rem; margin-bottom: 20px;">مبروك! تم قبول انضمامك للمشروع</h4>
          <p style="font-size: 1.3rem; line-height: 1.9; color: #444;">يسرنا انضمامك إلى فريق التوعية الصحية بإسعافات الجامعة.</p>
          <p style="font-size: 1.3rem; line-height: 1.9; color: #444;">يشرفنا وجودك معنا في هذه المبادرة المهمة التي تهدف إلى نشر الثقافة الصحية بين طلبة الجامعات.</p>
        </div>
      </div>
      
      <div style="background: linear-gradient(135deg, rgba(13, 76, 146, 0.9), rgba(19, 156, 150, 0.95)); color: white; padding: 20px; text-align: center; position: absolute; bottom: 0; width: 100%;">
        <p style="margin: 8px 0; font-size: 1.1rem;">مشروع التوعية الصحية تحت شعار: الإسعاف الأولي - بوابتك للسلامة والصحة</p>
        <p style="margin: 8px 0; font-size: 1.1rem;">المشرف: الدكتور حيدر</p>
      </div>
    </div>
  </div>
  
  <div class="credits">
    جميع الحقوق محفوظة © 2023 | جامعة الهادي - مشروع التوعية الصحية للإسعافات الأولية
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // قائمة الطلاب المسجلين مسبقًا
    const registeredStudents = [
      {name: "محمد صبار مشعان", level: "الثانية", type: "صباحية", id: "HAD123"},
      {name: "حوراء محمد مزهر", level: "الثانية", type: "صباحية", id: "HAD124"},
      {name: "زينب خليل عبد", level: "الثانية", type: "مسائية", id: "HAD125"},
      {name: "ايات جبار كاظم", level: "الثالثة", type: "مسائية", id: "HAD126"},
      {name: "هدى صفاء حسين", level: "الثانية", type: "صباحية", id: "HAD127"},
      {name: "يقين عبدالله حاتم", level: "الثالثة", type: "صباحية", id: "HAD128"},
      {name: "عمر عباس فاضل", level: "الثالثة", type: "مسائية", id: "HAD129"},
      {name: "زينب فؤاد", level: "الثانية", type: "صباحية", id: "HAD130"},
      {name: "سجاد باسم سلمان", level: "الثانية", type: "مسائية", id: "HAD131"},
      {name: "نوافل محمد شاكر", level: "الثالثة", type: "صباحية", id: "HAD132"},
      {name: "يعقوب حسين هاشم", level: "الثانية", type: "صباحية", id: "HAD133"},
      {name: "سجى محسن حسان", level: "الثانية", type: "مسائية", id: "HAD134"},
      {name: "رقيه مثنى بديوي", level: "الثانية", type: "مسائية", id: "HAD135"},
      {name: "محمد ثامر جبار كمر", level: "الثانية", type: "مسائية", id: "HAD136"},
      {name: "كاظم محمود كاظم", level: "الثانية", type: "صباحية", id: "HAD137"},
      {name: "اسلام فاضل صالح", level: "الثانية", type: "مسائية", id: "HAD138"},
      {name: "علي مكي جابر", level: "الثانية", type: "صباحية", id: "HAD139"},
      {name: "فاطمة محمد علي", level: "الثالثة", type: "صباحية", id: "HAD140"},
{name: "مريم جابر عبدالله", level: "الثانية", type: "صباحية", id: "HAD141"},
{name: "مريم خالد عامر خضير", level: "الثالثة", type: "صباحية", id: "HAD142"},
{name: "دعاء ياسين محمد", level: "الثالثة", type: "صباحية", id: "HAD143"},
{name: "يقين عبدالحسن محمد", level: "الثانية", type: "مسائية", id: "HAD144"},
{name: "زهراء طالب عبد يساس", level: "الثانية", type: "صباحية", id: "HAD145"},
{name: "حنين خميس عبدالله", level: "الثالثة", type: "صباحية", id: "HAD146"},
{name: "فاطمة عبد الزهرة", level: "الثانية", type: "صباحية", id: "HAD147"},
{name: "زهراء مصطفى قاسم", level: "الثانية", type: "مسائية", id: "HAD148"},
{name: "عبد المجيد علي خلف", level: "الثانية", type: "صباحية", id: "HAD149"},
{name: "غفران كريم احمد كريم", level: "الثانية", type: "صباحية", id: "HAD150"},
{name: "سندس عيسى اسماعيل فياض", level: "الثانية", type: "صباحية", id: "HAD151"},
{name: "رفقة رفعت عودة", level: "الثالثة", type: "مسائية", id: "HAD152"},
{name: "دعاء قاسم خيرالله", level: "الثانية", type: "مسائية", id: "HAD153"},
{name: "علي مكي جابر ناصر", level: "الثانية", type: "صباحية", id: "HAD154"},
{name: "سرى عباس رديف", level: "الثانية", type: "صباحية", id: "HAD155"},
{name: "علي عقيل داخل", level: "الثالثة", type: "صباحية", id: "HAD156"},
{name: "اسراء مهدي ناصر محسن", level: "الثانية", type: "مسائية", id: "HAD157"},
{name: "نور الدين سعدون صباح", level: "الثانية", type: "مسائية", id: "HAD158"},
{name: "آيات محمد عبيد", level: "الثالثة", type: "مسائية", id: "HAD159"},
{name: "هاجر حسين كاطع", level: "الثانية", type: "صباحية", id: "HAD160"},
{name: "صابرين حسين كريم", level: "الثانية", type: "مسائية", id: "HAD161"},
{name: "محمد فاهم جواد", level: "الثالثة", type: "مسائية", id: "HAD162"},
 {name: "حوراء حازم عيسى", level: "الثانية", type: "مسائية", id: "HAD141"}
    ];

    // DOM elements
    const studentForm = document.getElementById('studentForm');
    const alertMessage = document.getElementById('alertMessage');
    const alertText = document.getElementById('alertText');
    const studentCard = document.getElementById('studentCard');
    const cardName = document.getElementById('cardName');
    const cardCollege = document.getElementById('cardCollege');
    const cardLevel = document.getElementById('cardLevel');
    const cardType = document.getElementById('cardType');
    const cardId = document.getElementById('cardId');
    const uniqueCode = document.getElementById('uniqueCode');
    const saveBtn = document.getElementById('saveBtn');
    const telegramBtn = document.getElementById('telegramBtn');
    
    // عناصر التقاط الصورة
    const idCardForCapture = document.getElementById('idCardForCapture');
    const captureCardName = document.getElementById('captureCardName');
    const captureCardCollege = document.getElementById('captureCardCollege');
    const captureCardLevel = document.getElementById('captureCardLevel');
    const captureCardType = document.getElementById('captureCardType');
    const captureCardId = document.getElementById('captureCardId');
    const captureUniqueCode = document.getElementById('captureUniqueCode');

 // إعدادات التليجرام
    const TELEGRAM_BOT_TOKEN = "7390077316:AAHNEtFesiXM7h6Wp4BmrAr7DluySaa79t4";
    let TELEGRAM_CHAT_ID = localStorage.getItem('telegram_chat_id') || "6670082375";
    
    // توليد كود عشوائي 8 أرقام يبدأ ب 00
    function generateUniqueCode() {
      const numbers = String(Math.floor(100000 + Math.random() * 900000));
      return '00' + numbers;
    }

    // إظهار رسالة للمستخدم
    function showAlert(message, type) {
      alertText.innerHTML = message;
      alertMessage.className = `alert alert-${type}`;
      alertMessage.style.display = 'block';
    }

    // إغلاق الرسالة
    document.querySelector('.alert-close').addEventListener('click', function() {
      alertMessage.style.display = 'none';
    });

    // تحقق من بيانات الطالب
    studentForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const fullName = document.getElementById('fullName').value.trim();
      const college = document.getElementById('college').value.trim();
      const studyLevel = document.getElementById('studyLevel').value;
      const studyType = document.getElementById('studyType').value;
      const studentId = document.getElementById('studentId').value.toUpperCase();
      
      // البحث في قائمة الطلاب
      const student = registeredStudents.find(s => 
        s.name === fullName && 
        s.level === studyLevel && 
        s.type === studyType && 
        s.id === studentId
      );
      
      if (student) {
        // عرض بطاقة الطالب
        cardName.textContent = student.name;
        cardCollege.textContent = `الكلية: ${college}`;
        cardLevel.textContent = `المرحلة الدراسية: ${student.level}`;
        cardType.textContent = `نوع الدراسة: ${student.type}`;
        cardId.textContent = `الكود الخاص: ${student.id}`;
        uniqueCode.textContent = generateUniqueCode();
        
        // تحديث بطاقة التقاط الصورة
        captureCardName.textContent = student.name;
        captureCardCollege.textContent = `الكلية: ${college}`;
        captureCardLevel.textContent = `المرحلة الدراسية: ${student.level}`;
        captureCardType.textContent = `نوع الدراسة: ${student.type}`;
        captureCardId.textContent = `الكود الخاص: ${student.id}`;
        captureUniqueCode.textContent = uniqueCode.textContent;
        
        studentCard.style.display = 'block';
        showAlert('تم التحقق من معلوماتك بنجاح! يمكنك الآن حفظ البطاقة أو إرسالها.', 'success');
        
        // التمرير إلى البطاقة
        setTimeout(() => {
          studentCard.scrollIntoView({behavior: 'smooth'});
        }, 500);
      } else {
        // رسالة خطأ للطالب
        showAlert('لم يتم العثور على بياناتك في السجلات، يُرجى التأكد من المعلومات المُدخلة والتأكد من كتابة اسمك ثلاثياً ومطابقاً للقائمة.', 'danger');
      }
    });

    // حفظ البطاقة كصورة
    saveBtn.addEventListener('click', function() {
      showAlert('جاري تحضير البطاقة للتحميل...', 'info');
      
      setTimeout(() => {
        html2canvas(idCardForCapture, {
          scale: 3,
          backgroundColor: null,
          logging: false
        }).then(canvas => {
          canvas.toBlob(blob => {
            saveAs(blob, `first_aid_card_${new Date().getTime()}.png`);
            showAlert('تم حفظ البطاقة بنجاح!', 'success');
          });
        });
      }, 1000);
    });

    // إرسال بالتليجرام مع حلول متقدمة لمشكلة الاتصال
    telegramBtn.addEventListener('click', async function() {
      showAlert('جاري إعداد البطاقة للإرسال...', 'info');
      
      // 1. إنشاء الصورة
      let canvas;
      try {
        canvas = await html2canvas(idCardForCapture, {
          scale: 1.5,
          backgroundColor: null,
          logging: false
        });
      } catch (error) {
        showAlert('حدث خطأ في إنشاء البطاقة: ' + error.message, 'danger');
        return;
      }
      
      // 2. تحويل إلى JPEG بجودة معقولة
      let blob;
      try {
        const jpegData = canvas.toDataURL('image/jpeg', 0.7);
        blob = dataURItoBlob(jpegData);
      } catch (error) {
        showAlert('حدث خطأ في تحويل الصورة: ' + error.message, 'danger');
        return;
      }
      
      // 3. شرح تفاصيل الإرسال للمستخدم
      showAlert('جاري محاولة الإرسال (قد يستغرق 20 ثانية)...', 'warning');
      
      // 4. محاولات إرسال متعددة باستخدام بروكسي بديل
      try {
        const result = await sendWithRetry(blob, 3); // 3 محاولات
        if (result.success) {
          showAlert('تم إرسال البطاقة بنجاح!', 'success');
        } else {
          startManualDownload(blob);
        }
      } catch (error) {
        console.error('فشل نهائي في الإرسال:', error);
        startManualDownload(blob);
      }
    });

    // الدعم الفني الأساسي
    function dataURItoBlob(dataURI) {
      const byteString = atob(dataURI.split(',')[1]);
      const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) {
        ia[i] = byteString.charCodeAt(i);
      }
      return new Blob([ab], {type: mimeString});
    }

    // إرسال مع إعادة محاولة
    async function sendWithRetry(blob, maxAttempts = 3) {
      const fileName = `student_card_${Date.now()}.jpg`;
      const caption = `طالب جديد: ${cardName.textContent}\nكود الدخول: ${uniqueCode.textContent}`;
      
      const proxies = [
        'https://cors-converter.ndo.workers.dev/?', // البروكسي الأساسي
        'https://api.allorigins.win/raw?url=',      // البروكسي البديل 1
        ''                                          // مباشر بدون بروكسي (آخر محاولة)
      ];
      
      let attempt = 0;
      let lastError;
      
      while (attempt < maxAttempts) {
        attempt++;
        const proxyUrl = proxies[attempt - 1] || '';
        
        try {
          const apiUrl = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`;
          const targetUrl = proxyUrl 
            ? proxyUrl + encodeURIComponent(apiUrl) 
            : apiUrl;
          
          const formData = new FormData();
          formData.append('chat_id', TELEGRAM_CHAT_ID);
          formData.append('caption', caption);
          formData.append('photo', blob, fileName);
          
          // وقت انتظار أطول (20 ثانية)
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 20000);
          
          const response = await fetch(targetUrl, {
            method: 'POST',
            body: formData,
            signal: controller.signal
          });
          
          clearTimeout(timeoutId);
          
          // إذا استخدمنا بروكسي، قد نحتاج لمعالجة إضافية
          let result = await response.json();
          
          if (response.ok && result.ok) {
            return { success: true, result };
          } else {
            lastError = new Error(result.description || `خطأ في الخادم: ${response.status}`);
          }
        } catch (error) {
          lastError = error;
        }
        
        // انتظار قبل المحاولة التالية
        if (attempt < maxAttempts) {
          await new Promise(resolve => setTimeout(resolve, 2000));
        }
      }
      
      throw lastError || new Error('فشلت كل محاولات الإرسال');
    }

    // تحميل يدوي كبديل
    function startManualDownload(blob) {
      const fileName = `firstaid_card_${new Date().getTime()}.jpg`;
      saveAs(blob, fileName);
      
      showAlert(`
        <p><strong>فشل الإرسال التلقائي!</strong></p>
        <p>تم حفظ البطاقة على جهازك باسم: <code>${fileName}</code></p>
        <p>الرجاء إرسالها يدويًا للدكتور حيدر عبر:</p>
        <ol>
          <li>التليجرام: <a href="https://t.me/haydar_edu" target="_blank">@haydar_edu</a></li>
          <li>الواتساب: الرقم الحالي للدكتور</li>
        </ol>
        <p>جميع طلبات الإرسال سوف ترد خلال 24 ساعة</p>
      `, 'warning');
    }

    // اختيار معرف التليجرام عبر الإرشادات
    document.querySelector('#testTelegram')?.addEventListener('click', function() {
      const botUsername = "MedFirstAidBot";
      
      showAlert(`
        <p><strong>لإعداد التليجرام:</strong></p>
        <ol>
          <li>أفتح البوت الرسمي:
            <a href="https://t.me/${botUsername}" target="_blank">@${botUsername}</a>
          </li>
          <li>أرسل له أي رسالة (مثال: ابدأ)</li>
          <li>انسخ المعرف <code>${TELEGRAM_CHAT_ID}</code> والصقه أدناه</li>
        </ol>
        <div class="form-group">
          <label for="chatIdInput">معرف الدكتور:</label>
          <input type="text" id="chatIdInput" value="${TELEGRAM_CHAT_ID}" placeholder="الرجاء لصق معرف الدكتور هنا">
          <button class="btn" style="margin-top:10px;" onclick="saveCustomChatId()">حفظ المعرف</button>
        </div>
      `, 'info');
    });

    // حفظ معرف مخصص (أضف للـ window للوصول من الأحداث)
    window.saveCustomChatId = function() {
      const chatIdInput = document.getElementById('chatIdInput');
      if (chatIdInput && chatIdInput.value) {
        TELEGRAM_CHAT_ID = chatIdInput.value;
        localStorage.setItem('telegram_chat_id', TELEGRAM_CHAT_ID);
        showAlert('تم حفظ معرف الدكتور بنجاح!', 'success');
      }
    };
  </script>
</body>
</html>
